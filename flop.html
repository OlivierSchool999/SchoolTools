<!DOCTYPE html>
<html lang="nl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Mini Window</title>
</head>
<body>
<h1>Flappy Bird Main Window</h1>
<p>Druk op spatie om te springen.</p>
<script>
let miniWindow = null;

function openMiniWindow() {
    if (miniWindow == null || miniWindow.closed) {
        miniWindow = window.open("", "FlappyMini", "width=300,height=400,resizable=yes");
        miniWindow.document.write(`
            <!DOCTYPE html>
            <html lang="nl">
            <head>
            <meta charset="UTF-8">
            <title>Flappy Bird Mini</title>
            <style>
            body { margin:0; overflow:hidden; background:#70c5ce; }
            canvas { display:block; margin:0 auto; background:#70c5ce; }
            </style>
            </head>
            <body>
            <canvas id="gameCanvas" width="400" height="600"></canvas>
            <script>
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            let bird = { x:50,y:300,w:20,h:20,dy:0 };
            let pipes = [];
            let gravity=0.6; let jump=-10; let frame=0; let gameOver=false;
            function createPipe() {
                const gap=100; const topHeight=Math.random()*200+50;
                const bottomHeight=canvas.height-topHeight-gap;
                pipes.push({x:canvas.width,top:topHeight,bottom:bottomHeight});
            }
            function resetGame() { bird={x:50,y:300,w:20,h:20,dy:0}; pipes=[]; frame=0; gameOver=false; }
            function update() {
                if(gameOver) return;
                bird.dy+=gravity; bird.y+=bird.dy;
                if(bird.y+bird.h>canvas.height||bird.y<0) gameOver=true;
                frame++; if(frame%90===0) createPipe();
                for(let pipe of pipes){
                    pipe.x-=2;
                    if(bird.x+bird.w>pipe.x && bird.x<pipe.x+40 &&
                        (bird.y<pipe.top||bird.y+bird.h>canvas.height-pipe.bottom)) gameOver=true;
                }
                pipes=pipes.filter(p=>p.x+40>0);
            }
            function draw() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle="yellow"; ctx.fillRect(bird.x,bird.y,bird.w,bird.h);
                ctx.fillStyle="green";
                for(let pipe of pipes){
                    ctx.fillRect(pipe.x,0,40,pipe.top);
                    ctx.fillRect(pipe.x,canvas.height-pipe.bottom,40,pipe.bottom);
                }
            }
            function loop(){ update(); draw(); requestAnimationFrame(loop); }
            document.addEventListener('keydown',e=>{ if(e.code==='Space'){ bird.dy=jump; if(gameOver) resetGame(); } });
            loop();
            <\/script>
            </body>
            </html>
        `);
    }
}

// Open mini window wanneer tab out-of-focus gaat
window.addEventListener('blur', openMiniWindow);
</script>
</body>
</html>
